{"version":3,"sources":["../src/packager.js"],"names":["fs","require","_","fullDeps","dirs","map","dir","index","indexOf","packageJsonFile","existsSync","JSON","parse","readFileSync","getDependencies","json","item","Object","keys","dependencies","concat","apply","getPackages","deps","without","undefined","packager","finalData","Promise","resolve","reject","readdir","err","console","log","packages","forEach","data","comma","length","name","version","module","exports"],"mappings":";;AAAA,IAAIA,KAAKC,QAAQ,IAAR,CAAT;AAAA,IACIC,IAAID,QAAQ,QAAR,CADR;;AAGA,IAAME,WAAW,SAAXA,QAAW,CAACC,IAAD,EAAU;AACzB,SAAOA,KAAKC,GAAL,CAAS,UAACC,GAAD,EAAMC,KAAN,EAAgB;AAC9B,QAAID,IAAIE,OAAJ,CAAY,GAAZ,MAAqB,CAAzB,EAA4B;AAC1B,UAAIC,kBAAkB,oBAAoBH,GAApB,GAA0B,eAAhD;AACA,UAAIN,GAAGU,UAAH,CAAcD,eAAd,CAAJ,EAAoC;AAClC,eAAOE,KAAKC,KAAL,CAAWZ,GAAGa,YAAH,CAAgBJ,eAAhB,CAAX,CAAP;AACD;AACF;AACF,GAPM,CAAP;AAQD,CATD;;AAWA,IAAMK,kBAAkB,SAAlBA,eAAkB,CAACV,IAAD,EAAU;AAChC,MAAIW,OAAOZ,SAASC,IAAT,EAAeC,GAAf,CAAmB,UAACW,IAAD,EAAOT,KAAP,EAAiB;AAC7C,QAAIS,IAAJ,EAAU;AACR,aAAOC,OAAOC,IAAP,CAAYF,KAAKG,YAAjB,CAAP;AACD;AACF,GAJU,CAAX;AAKA,SAAO,GAAGC,MAAH,CAAUC,KAAV,CAAgB,EAAhB,EAAoBN,IAApB,CAAP;AACD,CAPD;;AASA,IAAMO,cAAc,SAAdA,WAAc,CAACH,YAAD,EAAef,IAAf,EAAwB;AAC1C,MAAMmB,OAAOnB,KAAKC,GAAL,CAAS,UAACW,IAAD,EAAU;AAC9B,QAAIA,IAAJ,EAAU;AACR,UAAIG,aAAaX,OAAb,CAAqBQ,IAArB,IAA6B,CAAjC,EAAoC;AAClC,eAAOA,IAAP;AACD;AACF;AACF,GANY,CAAb;AAOA,SAAOd,EAAEsB,OAAF,CAAUD,IAAV,EAAgBE,SAAhB,CAAP;AACD,CATD;;AAWA,IAAMC,WAAW,SAAXA,QAAW,GAAM;AACrB,MAAIC,YAAY,EAAhB;AACA,SAAO,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtC9B,OAAG+B,OAAH,CAAW,gBAAX,EAA6B,UAACC,GAAD,EAAM5B,IAAN,EAAe;AAC1C,UAAI4B,GAAJ,EAAS;AACPC,gBAAQC,GAAR,CAAYF,GAAZ;AACA;AACD;AACD,UAAMG,WAAWb,YAAYR,gBAAgBV,IAAhB,CAAZ,EAAmCA,IAAnC,CAAjB;AACA+B,eAASC,OAAT,CAAiB,UAAC9B,GAAD,EAAMC,KAAN,EAAgB;AAC/B,YAAID,IAAIE,OAAJ,CAAY,GAAZ,MAAqB,CAAzB,EAA4B;AAC1B,cAAIC,kBAAkB,oBAAoBH,GAApB,GAA0B,eAAhD;AACA,cAAIN,GAAGU,UAAH,CAAcD,eAAd,CAAJ,EAAoC;AAClC,gBAAI4B,OAAOrC,GAAGa,YAAH,CAAgBJ,eAAhB,CAAX;AACA,gBAAIuB,GAAJ,EAAS;AACPC,sBAAQC,GAAR,CAAYF,GAAZ;AACD,aAFD,MAEO;AACL,kBAAIjB,OAAOJ,KAAKC,KAAL,CAAWyB,IAAX,CAAX;AACA,kBAAIC,QAAQ/B,QAAQ4B,SAASI,MAAT,GAAkB,CAA1B,GAA8B,OAA9B,GAAwC,KAApD;AACAZ,0BAAYA,uBAAoBZ,KAAKyB,IAAzB,YAAoCzB,KAAK0B,OAAzC,GAAmDH,KAAnD,CAAZ;AACD;AACF;AACF;AACF,OAdD;AAeAT,cAAQF,SAAR;AACD,KAtBD;AAuBD,GAxBM,CAAP;AAyBD,CA3BD;;AA6BAe,OAAOC,OAAP,GAAiBjB,QAAjB","file":"packager.js","sourcesContent":["let fs = require('fs'),\n    _ = require('lodash')\n\nconst fullDeps = (dirs) => {\n  return dirs.map((dir, index) => {\n    if (dir.indexOf('.') !== 0) {\n      let packageJsonFile = './node_modules/' + dir + '/package.json'\n      if (fs.existsSync(packageJsonFile)) {\n        return JSON.parse(fs.readFileSync(packageJsonFile))\n      }\n    }\n  })\n}\n\nconst getDependencies = (dirs) => {\n  let json = fullDeps(dirs).map((item, index) => {\n    if (item) {\n      return Object.keys(item.dependencies)\n    }\n  })\n  return [].concat.apply([], json)\n}\n\nconst getPackages = (dependencies, dirs) => {\n  const deps = dirs.map((item) => {\n    if (item) {\n      if (dependencies.indexOf(item) < 0) {\n        return item\n      }\n    }\n  })\n  return _.without(deps, undefined)\n}\n\nconst packager = () => {\n  let finalData = ''\n  return new Promise((resolve, reject) => {\n    fs.readdir('./node_modules', (err, dirs) => {\n      if (err) {\n        console.log(err)\n        return\n      }\n      const packages = getPackages(getDependencies(dirs), dirs)\n      packages.forEach((dir, index) => {\n        if (dir.indexOf('.') !== 0) {\n          let packageJsonFile = './node_modules/' + dir + '/package.json'\n          if (fs.existsSync(packageJsonFile)) {\n            let data = fs.readFileSync(packageJsonFile)\n            if (err) {\n              console.log(err)\n            } else {\n              let json = JSON.parse(data)\n              let comma = index < packages.length - 1 ? '\", \\n' : '\"\\n'\n              finalData = finalData + `    \"${json.name}\": \"${json.version}${comma}`\n            }\n          }\n        }\n      })\n      resolve(finalData)\n    })\n  })\n}\n\nmodule.exports = packager\n"]}